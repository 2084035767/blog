---
title: 关于| 语义化版本控制
date: 2023-10-11
categories:
  - 编程知识
---

# 语义化版本控制

:::tip

“依赖地狱”的死亡之谷？`node_modules` 黑洞？🙄

:::



## 简介

在软件开发中，版本号不仅是简单的数字标签，更是向开发者传达代码变更意图的重要工具。**语义化版本控制（Semantic Versioning，简称 SemVer）** 通过一套明确的规则，让版本号的变化与代码的兼容性直接关联，从而帮助开发者更好地管理依赖关系。

其核心规则如下：

**版本格式**：`主版本号.次版本号.修订号`（`X.Y.Z`），遵循以下递增规则：

1. **主版本号（X）**：当代码变更导致 **API 不兼容** 时递增（例如：`1.0.0` → `2.0.0`）。
2. **次版本号（Y）**：当新增 **向下兼容的功能** 时递增（例如：`1.0.0` → `1.1.0`）。
3. **修订号（Z）**：当修复 **向下兼容的问题** 时递增（例如：`1.0.0` → `1.0.1`）。



### 依赖地狱的困境
当项目依赖的第三方库越来越多时，版本管理可能陷入两难：
- **版本锁死**：依赖过于严格，升级时需要逐个修改所有依赖项。
- **版本混乱**：依赖过于松散，不同版本的兼容性难以保证。

语义化版本控制通过明确的版本号规则，让开发者能够精确声明依赖范围，从而平衡灵活性与稳定性。



## 标准规范



### 核心规则
1. **公共 API 必须明确定义** ：公共 API 可以通过代码或文档形式定义，它是语义化版本控制的基础，用于判断版本变更的影响范围。
2. **版本号格式为 `X.Y.Z`** ：版本号由三个部分组成，分别为主版本号（X）、次版本号（Y）和修订号（Z），中间用点号分隔，且禁止补前导零，例如：`1.09.0` 应改为 `1.9.0`。
3. **禁止修改已发布的版本内容** ：一旦软件版本发布，其内容不可修改，如有需要，必须发布新版本。
4. **主版本号为 `0` 时（如 `0.1.0`）** ：表示软件处于不稳定阶段，公共 API 可能会发生不兼容的变动。
5. **`1.0.0` 是首个稳定版本** ：当软件达到 `1.0.0` 版本时，公共 API 已经稳定，之后的版本变更需遵循语义化版本控制规则，确保向后兼容性。



### 进阶规则
- **先行版本号**：通过后缀标识不稳定版本（例如：`1.0.0-alpha`、`1.0.0-beta.2`）。 
- **版本编译信息**：通过 `+` 附加元数据（例如：`1.0.0+20231011`），不影响版本优先级。
- **版本优先级比较**：
  - 按 `主版本号 → 次版本号 → 修订号 → 先行版本号` 顺序比较。
  - 数字标识符按数值比较，非数字标识符按 ASCII 顺序排序（例如：`1.0.0-beta.2 < 1.0.0-beta.11`）。




#### 常见问题

1. **主版本为 `0` 的情况**：  
   - `^0.1.0` 实际等效于 `~0.1.0`（仅允许修订号升级），因为 `0.y.z` 表示初始开发阶段，无稳定性保证。

2. **版本号补零规则**：  
   - `3.1` 会被补全为 `3.1.0`，`3` 补全为 `3.0.0`。

3. **结合工具使用**：  
   - 使用 `npm outdated` 查看过时依赖。  
   - 使用 `npm update` 安全升级符合范围的依赖。



### 常用符号说明

| 符号     | 示例         | 允许范围                 | 典型用途                  |
| -------- | ------------ | ------------------------ | ------------------------- |
| `^`      | `^3.1.0`     | `3.1.0` ≤ 版本 < `4.0.0` | 自动获取兼容的新功能/修复 |
| `~`      | `~3.1.0`     | `3.1.0` ≤ 版本 < `3.2.0` | 仅接受问题修复            |
| `>= <`   | `>=3.1.0 <4` | `3.1.0` ≤ 版本 < `4.0.0` | 自定义版本区间            |
| `x`      | `3.x`        | `3.0.0` ≤ 版本 < `4.0.0` | 快速匹配主版本            |
| 精确版本 | `3.1.0`      | 仅 `3.1.0`               | 锁定版本，避免变更        |
| latest   |              |                          |                           |



### 常见先行版本标识符

| 标识符         | 示例             | 用途说明                                                     |
| :------------- | :--------------- | :----------------------------------------------------------- |
| **`alpha`**    | `1.0.0-alpha`    | 内部测试版本，功能不完整，可能存在重大缺陷。                 |
| **`beta`**     | `1.0.0-beta.1`   | 公开测试版本，功能基本完成，邀请外部用户或开发者测试。       |
| **`rc`**       | `1.0.0-rc.2`     | **候选发布版（Release Candidate）**，接近正式版，修复了大部分已知问题。 |
| **`dev`**      | `1.0.0-dev`      | 开发中的版本，代码可能频繁变动。                             |
| **`snapshot`** | `1.0.0-snapshot` | 快照版本（常见于 Maven），表示正在开发中的最新代码。         |
| **`canary`**   | `1.0.0-canary`   | 灰度发布版本，用于小范围验证新功能或修复。                   |
| **日期或哈希** | `1.0.0-20231015` | 用日期或 Git 提交哈希标识版本（例如 `1.0.0-abc1234`）。      |



## 包管理安装

```bash
# 安装特定版本
npm install lodash@4.17.21

# 安装标识版本
npm install lodash@^4.17.21

# 表示匹配所有版本，不限制范围
npm install lodash@4.*

# 指定特定范围内的版本
npm install lodash@>=4.17.21 <5.0.0

# 安装最新版本
npm install lodash@latest
```





## 参考三三

- https://semver.org/lang/zh-CN/
- https://npm.nodejs.cn/about-semantic-versioning
- AI
